import{u as I,r as n,j as e,H as L,b as R}from"./app-pOO083-e.js";import{A as O}from"./app-layout-Dc3hkrhW.js";import{T as F,a as H,b as u,c as p,d as K,e as c}from"./table-BS9Jhd1O.js";import{B as g}from"./button-C04eTuKF.js";import{I as A}from"./input-BNUIgu_-.js";import{F as E,z as o}from"./index-CJOt3l_0.js";import{Q as M,a as U}from"./QRScannerModal-BYwcAOmS.js";/* empty css            */import"./app-sidebar-header-COL4hiO2.js";import"./createLucideIcon-DoMVaiJs.js";import"./index-D3C--ds9.js";import"./index-hFgQNbVr.js";import"./index-BvNCmLem.js";import"./index-DwhOcVGB.js";import"./log-out-02q7rZj1.js";import"./x-C-J8wUVu.js";import"./index-D0bkFEMS.js";import"./settings-BYB2_0H7.js";import"./file-text-pZ84JjBm.js";import"./dialog-C6812wCE.js";const W=a=>{if(a>3&&a<21)return`${a}th`;switch(a%10){case 1:return`${a}st`;case 2:return`${a}nd`;case 3:return`${a}rd`;default:return`${a}th`}};function xe(){const{props:a}=I(),[T,f]=n.useState(a.clearances||[]),[r]=n.useState(a.officials||[]),[j,_]=n.useState(""),[t,b]=n.useState(null),[i,y]=n.useState(!1),[$,N]=n.useState(!1),x=new Date,k=`${W(x.getDate())} of ${x.toLocaleDateString("en-US",{month:"long"})}, ${x.getFullYear()}`,d=r.find(s=>s.position==="Punong Barangay"),w=r.filter(s=>s.position==="Barangay Kagawad"),C=r.find(s=>s.position==="SK Chairman"),v=r.find(s=>["Secretary","Barangay Secretary"].includes(s.position)),S=r.find(s=>["Treasurer","Barangay Treasurer"].includes(s.position)),D=async s=>{try{await R.post(`/documentrequests/release/${s}`),f(m=>m.map(l=>l.qr_token===s?{...l,status:"released"}:l)),o.success("Document status updated to Released!")}catch{o.error("Failed to release document. Invalid QR code?")}},B=async(s,m=!1)=>{b(s),setTimeout(async()=>{if(!i){y(!0);try{if(!m&&s.status==="on process"){const l=await R.put(`/documentrequests/${s.id}/ready`);f(z=>z.map(h=>h.id===s.id?{...h,status:"ready for pick-up"}:h)),o.success(l.data.message||"Document marked Ready for Pick-up!")}else m&&o.success("Reprinting document...")}catch{o.error("Failed to update document status.")}finally{y(!1)}window.print(),b(null)}},200)},P=T.filter(s=>`${s.resident.first_name} ${s.resident.last_name}`.toLowerCase().includes(j.toLowerCase())),Q=s=>s?`${window.location.origin}/documentrequests/release/${s}`:"";return e.jsxs(O,{breadcrumbs:[{title:"Barangay Clearance",href:"/barangay-clearance"}],children:[e.jsx(L,{title:"Barangay Clearance"}),e.jsx(E,{position:"top-right"}),e.jsxs("div",{className:"flex justify-between items-center mb-8 bg-green-600 text-white shadow p-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Barangay Clearance Requests"}),e.jsx(g,{onClick:()=>N(!0),className:"bg-white text-green-700 hover:bg-green-100",children:"Scan QR Code"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(A,{placeholder:"Search by resident name...",value:j,onChange:s=>_(s.target.value),className:"max-w-sm mb-4"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(F,{children:[e.jsx(H,{children:e.jsxs(u,{children:[e.jsx(p,{children:"Name"}),e.jsx(p,{children:"Purpose"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Action"})]})}),e.jsx(K,{children:P.length?P.map(s=>e.jsxs(u,{children:[e.jsxs(c,{children:[s.resident.first_name," ",s.resident.last_name]}),e.jsx(c,{children:s.purpose}),e.jsx(c,{className:"capitalize",children:s.status}),e.jsxs(c,{children:[s.status==="on process"&&e.jsx(g,{size:"sm",onClick:()=>B(s),disabled:i,children:i&&t?.id===s.id?"Printing...":"Print"}),(s.status==="ready for pick-up"||s.status==="released")&&e.jsx(g,{size:"sm",variant:"outline",onClick:()=>B(s,!0),disabled:i,children:i&&t?.id===s.id?"Reprinting...":"Reprint"}),s.status==="pending"&&e.jsx("span",{className:"text-gray-500 font-semibold",children:"Pending"})]})]},s.id)):e.jsx(u,{children:e.jsx(c,{colSpan:4,className:"text-center text-gray-500",children:"No Barangay Clearance requests found."})})})]})})]}),e.jsx(M,{open:$,onClose:()=>N(!1),onScanSuccess:D}),t&&e.jsxs("div",{id:"print-area",className:"hidden print:block relative bg-white text-black leading-relaxed",style:{width:"185mm",height:"270mm",padding:"10mm",border:"10px solid #1B5E20",fontFamily:"'Times New Roman', serif"},children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("img",{src:"/images/logo.png",alt:"Left Logo",className:"w-20 h-20"}),e.jsxs("div",{children:[e.jsx("p",{children:"Republic of the Philippines"}),e.jsx("p",{children:"Province of Misamis Oriental"}),e.jsx("p",{children:"City of Cagayan de Oro"}),e.jsx("p",{className:"font-bold uppercase text-green-800",children:"Barangay Iponan"})]}),e.jsx("img",{src:"/images/cdologo.png",alt:"Right Logo",className:"w-20 h-20"})]}),e.jsx("h2",{className:"mt-4 font-bold text-lg uppercase text-green-700",children:"Office of the Punong Barangay"}),e.jsx("hr",{className:"border-green-700 my-2"}),e.jsx("h1",{className:"text-3xl font-bold underline uppercase text-green-900",children:"Barangay Clearance"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mt-10",children:[e.jsxs("div",{className:"col-span-1 text-sm p-4 border border-green-700 rounded-lg bg-green-100 shadow",children:[e.jsx("h2",{className:"font-bold text-green-800 text-center mb-4 text-base",children:"Barangay Officials"}),d&&e.jsxs("p",{className:"font-bold",children:[d.complete_name,e.jsx("br",{}),"Punong Barangay"]}),w.length>0&&e.jsx("p",{className:"underline",children:"Barangay Kagawad"}),e.jsx("ul",{className:"ml-2 mb-3 list-disc list-inside",children:w.map(s=>e.jsx("li",{children:s.complete_name},s.id))}),C&&e.jsxs("p",{className:"mt-2 font-bold",children:[C.complete_name,e.jsx("br",{}),"SK Chairman"]}),v&&e.jsxs("p",{className:"mt-3 font-bold",children:[v.complete_name,e.jsx("br",{}),"Secretary"]}),S&&e.jsxs("p",{className:"mt-3 font-bold",children:[S.complete_name,e.jsx("br",{}),"Treasurer"]})]}),e.jsxs("div",{className:"col-span-2 text-justify text-[15px] relative pl-6",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 opacity-10 flex items-center pr-10",children:e.jsx("img",{src:"/images/logo.png",alt:"Watermark",className:"w-80 h-80"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{children:["This is to certify that ",e.jsxs("span",{className:"font-bold underline",children:[t.resident.first_name," ",t.resident.last_name]})," residing at Barangay Iponan, Cagayan de Oro City, is a bona fide resident of this barangay."]}),e.jsxs("p",{className:"mt-4",children:["This certification is issued upon request for the purpose of ",e.jsx("span",{className:"font-bold underline",children:t.purpose}),"."]}),e.jsxs("p",{className:"mt-4",children:["Given this ",e.jsx("span",{className:"underline",children:k})," at Barangay Iponan, Cagayan de Oro City, Misamis Oriental."]}),d&&e.jsxs("div",{className:"mt-16 text-right pr-16",children:[e.jsx("p",{className:"font-bold uppercase text-green-900",children:d.complete_name}),e.jsx("p",{children:"Punong Barangay"})]}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx(U,{value:Q(t.qr_token),size:120})}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Scan QR code to verify release status"})]})]})]}),e.jsx("div",{className:"absolute bottom-10 left-0 right-0 text-center",children:e.jsx("p",{className:"text-green-800 font-bold uppercase tracking-wider text-lg",children:"Certified True Copy"})})]})]})}export{xe as default};
