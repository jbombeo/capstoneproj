import{u as F,r as i,j as e,H as I,a as B}from"./app-_wj1wiEc.js";import{A as L}from"./app-layout-BSN3Q_UY.js";import{T as A,a as O,b as h,c as p,d as H,e as c}from"./table-55CpEnKH.js";import{B as f}from"./button-HZSfloRH.js";import{I as K}from"./input-CaSbsQoB.js";import{F as E,z as o}from"./index-9aUBe4GY.js";import{Q as M,a as U}from"./QRScannerModal-IX9kCwt1.js";import"./app-DgE45SX0.js";import"./utils-csTuJWuA.js";import"./clsx-B-dksMZM.js";import"./index-DVkLe2dy.js";import"./index-DlLLoGOC.js";import"./index-Dl6FYVux.js";import"./index-CObx42Nt.js";import"./x-cF_pgnf8.js";import"./createLucideIcon-Dk2zpREm.js";import"./index-BRMnPjnz.js";import"./chevron-down-Ciywszaj.js";import"./index-CRvzyME4.js";import"./index-CDy59-5j.js";import"./index-CMWG4mbA.js";import"./log-out-CytyyNiJ.js";import"./users-CzPkGoWA.js";import"./map-pin-K0z2MPXY.js";import"./file-text-ZNTU_lRQ.js";import"./clipboard-list-iHk9S1ba.js";import"./settings-B87Gxw1-.js";import"./dialog-BHDE3h_S.js";const W=t=>{if(t>3&&t<21)return`${t}th`;switch(t%10){case 1:return`${t}st`;case 2:return`${t}nd`;case 3:return`${t}rd`;default:return`${t}th`}};function Ne(){const{props:t}=F(),[$,g]=i.useState(t.requests||[]),[n]=i.useState(t.officials||[]),[a,j]=i.useState(null),[b,P]=i.useState(""),[r,y]=i.useState(!1),[T,N]=i.useState(!1),x=new Date,k=`${W(x.getDate())} of ${x.toLocaleDateString("en-US",{month:"long"})}, ${x.getFullYear()}`,d=n.find(s=>s.position==="Punong Barangay"),v=n.filter(s=>s.position==="Barangay Kagawad"),w=n.find(s=>s.position==="SK Chairman"),S=n.find(s=>["Secretary","Barangay Secretary"].includes(s.position)),C=n.find(s=>["Treasurer","Barangay Treasurer"].includes(s.position)),D=async s=>{try{await B.post(`/documentrequests/release/${s}`),g(m=>m.map(l=>l.qr_token===s?{...l,status:"released"}:l)),o.success("Document status updated to Released!")}catch{o.error("Failed to release document. Invalid QR code?")}},R=async(s,m=!1)=>{j(s),setTimeout(async()=>{if(!r){y(!0);try{if(!m&&s.status==="on process"){const l=await B.put(`/documentrequests/${s.id}/ready`);g(z=>z.map(u=>u.id===s.id?{...u,status:"ready for pick-up"}:u)),o.success(l.data.message||"Document marked Ready for Pick-up!")}else m&&o.success("Reprinting document...")}catch{o.error("Failed to update document status.")}finally{y(!1)}window.print(),j(null)}},200)},_=$.filter(s=>`${s.resident.first_name} ${s.resident.last_name}`.toLowerCase().includes(b.toLowerCase())),Q=s=>s?`${window.location.origin}/documentrequests/release/${s}`:"";return e.jsxs(L,{breadcrumbs:[{title:"Certificate of Residency",href:"/Residency"}],children:[e.jsx(I,{title:"Certificate of Residency"}),e.jsx(E,{position:"top-right"}),e.jsxs("div",{className:"flex justify-between items-center mb-8 bg-green-600 text-white shadow p-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Certificate of Residency Requests"}),e.jsx(f,{onClick:()=>N(!0),className:"bg-white text-blue-900 hover:bg-blue-100",children:"Scan QR Code"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(K,{placeholder:"Search by resident name...",value:b,onChange:s=>P(s.target.value),className:"max-w-sm mb-4"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(A,{children:[e.jsx(O,{children:e.jsxs(h,{children:[e.jsx(p,{children:"Name"}),e.jsx(p,{children:"Purpose"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Action"})]})}),e.jsx(H,{children:_.length?_.map(s=>e.jsxs(h,{children:[e.jsxs(c,{children:[s.resident.first_name," ",s.resident.middle_name||""," ",s.resident.last_name]}),e.jsx(c,{children:s.purpose}),e.jsx(c,{className:"capitalize",children:s.status}),e.jsxs(c,{children:[s.status==="on process"&&e.jsx(f,{size:"sm",onClick:()=>R(s),disabled:r,children:r&&a?.id===s.id?"Printing...":"Print"}),(s.status==="ready for pick-up"||s.status==="released")&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>R(s,!0),disabled:r,children:r&&a?.id===s.id?"Reprinting...":"Reprint"})]})]},s.id)):e.jsx(h,{children:e.jsx(c,{colSpan:4,className:"text-center text-gray-500",children:"No requests found."})})})]})})]}),e.jsx(M,{open:T,onClose:()=>N(!1),onScanSuccess:D}),a&&e.jsxs("div",{id:"print-area",className:"hidden print:block relative bg-white text-black font-serif",style:{width:"185mm",height:"270mm",padding:"12mm",border:"10px solid #1E3A8A"},children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("img",{src:"/images/logo.png",alt:"Logo Left",className:"w-20 h-20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:"Republic of the Philippines"}),e.jsx("p",{className:"text-sm",children:"Region X-Northern Mindanao"}),e.jsx("p",{className:"text-sm",children:"City of Cagayan de Oro"}),e.jsx("p",{className:"font-bold uppercase text-blue-800",children:"Barangay Iponan"})]}),e.jsx("img",{src:"/images/cdologo.png",alt:"Logo Right",className:"w-20 h-20"})]}),e.jsx("h2",{className:"mt-4 font-bold text-lg uppercase text-blue-700",children:"Office of the Barangay Council"}),e.jsx("hr",{className:"border-blue-700 my-2"}),e.jsx("h1",{className:"text-3xl font-bold underline uppercase text-blue-900",children:"Certificate of Residency"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mt-10",children:[e.jsx("div",{className:"col-span-1 pr-4 text-sm",children:e.jsxs("div",{className:"p-4 rounded-lg shadow-md border border-blue-700 bg-blue-50",children:[e.jsx("h2",{className:"font-bold text-blue-800 text-center mb-4 text-base",children:"Barangay Officials"}),d&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold text-[15px]",children:d.complete_name}),e.jsx("p",{className:"mb-3",children:"Punong Barangay"})]}),v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"underline",children:"Barangay Kagawad"}),e.jsx("ul",{className:"ml-2 mb-3 list-disc list-inside",children:v.map(s=>e.jsx("li",{className:"text-[15px] font-medium",children:s.complete_name},s.id))})]}),w&&e.jsxs("p",{className:"mt-2",children:[e.jsx("span",{className:"font-bold text-[15px]",children:w.complete_name}),e.jsx("br",{}),"SK Chairman"]}),S&&e.jsxs("p",{className:"mt-3",children:[e.jsx("span",{className:"font-bold text-[15px]",children:S.complete_name}),e.jsx("br",{}),"Secretary"]}),C&&e.jsxs("p",{className:"mt-3",children:[e.jsx("span",{className:"font-bold text-[15px]",children:C.complete_name}),e.jsx("br",{}),"Treasurer"]})]})}),e.jsxs("div",{className:"col-span-2 pl-6 text-justify text-[15px] relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center opacity-10 pr-10",children:e.jsx("img",{src:"/images/logo.png",alt:"Watermark",className:"w-90 h-90"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{children:["This is to certify that ",e.jsxs("strong",{children:[a.resident.first_name," ",a.resident.middle_name||""," ",a.resident.last_name]}),", residing at ",e.jsx("strong",{children:a.resident.address||"Barangay Iponan"}),", Cagayan de Oro City, is a bonafide resident of this barangay."]}),e.jsxs("p",{className:"mt-4",children:["This certification is issued upon the request of the above-named person for ",e.jsx("strong",{children:a.purpose}),"."]}),e.jsxs("p",{className:"mt-4",children:["Given this ",e.jsx("strong",{className:"underline",children:k})," at Barangay Iponan, Cagayan de Oro City."]}),d&&e.jsxs("div",{className:"mt-16 text-right pr-16",children:[e.jsx("p",{className:"font-bold uppercase text-blue-900",children:d.complete_name}),e.jsx("p",{children:"Punong Barangay"})]}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx(U,{value:Q(a.qr_token),size:120})}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Scan QR code to verify document validity"})]})]})]})]})]})}export{Ne as default};
