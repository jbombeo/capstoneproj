import{u as Q,r as n,j as e,H as F,b as _}from"./app-BYDD7jqK.js";import{A as G}from"./app-layout-DwJpk70a.js";import{T as I,a as L,b as h,c as p,d as O,e as l}from"./table-DLidGIvn.js";import{B as f}from"./button-Dr-gN8dc.js";import{I as A}from"./input-iCoYWyDm.js";import{F as H,z as c}from"./index-BhTkidEM.js";import{Q as K,a as E}from"./QRScannerModal-C8J-v7x8.js";/* empty css            */import"./app-sidebar-header-p_ZutQgq.js";import"./createLucideIcon-DdLpzc9k.js";import"./index-B2jg6ky-.js";import"./index-CoyH5QwD.js";import"./index-WOlHJoPy.js";import"./index-DwhOcVGB.js";import"./log-out-Be8tPfcd.js";import"./x-JC7lT9T1.js";import"./index-fql2wrXq.js";import"./settings-D0VBnQjg.js";import"./file-text-BVrqHHw0.js";import"./dialog-A7zjs0bz.js";const U=a=>{if(a>3&&a<21)return`${a}th`;switch(a%10){case 1:return`${a}st`;case 2:return`${a}nd`;case 3:return`${a}rd`;default:return`${a}th`}};function ue(){const{props:a}=Q(),[R,g]=n.useState(a.docs||[]),[i]=n.useState(a.officials||[]),[j,$]=n.useState(""),[t,b]=n.useState(null),[r,N]=n.useState(!1),[D,y]=n.useState(!1),x=new Date,T=`${U(x.getDate())} of ${x.toLocaleDateString("en-US",{month:"long"})}, ${x.getFullYear()}`,d=i.find(s=>s.position==="Punong Barangay"),w=i.filter(s=>s.position==="Barangay Kagawad"),v=i.find(s=>s.position==="SK Chairman"),S=i.find(s=>["Secretary","Barangay Secretary"].includes(s.position)),C=i.find(s=>["Treasurer","Barangay Treasurer"].includes(s.position)),k=async s=>{try{await _.post(`/documentrequests/release/${s}`),g(m=>m.map(o=>o.qr_token===s?{...o,status:"released"}:o)),c.success("Document status updated to Released!")}catch{c.error("Failed to release document. Invalid QR code?")}},B=async(s,m=!1)=>{b(s),setTimeout(async()=>{if(!r){N(!0);try{if(!m&&s.status==="on process"){const o=await _.put(`/documentrequests/${s.id}/ready`);g(z=>z.map(u=>u.id===s.id?{...u,status:"ready for pick-up"}:u)),c.success(o.data.message||"Document marked Ready for Pick-up!")}else m&&c.success("Reprinting document...")}catch{c.error("Failed to update document status.")}finally{N(!1)}window.print(),b(null)}},200)},P=R.filter(s=>s.document_type?.name==="Certificate of Good Moral").filter(s=>`${s.resident.first_name} ${s.resident.last_name}`.toLowerCase().includes(j.toLowerCase())),M=s=>s?`${window.location.origin}/documentrequests/release/${s}`:"";return e.jsxs(G,{breadcrumbs:[{title:"Certificate of Good Moral",href:"/good-moral"}],children:[e.jsx(F,{title:"Certificate of Good Moral"}),e.jsx(H,{position:"top-right"}),e.jsxs("div",{className:"flex justify-between items-center mb-8 bg-green-600 text-white shadow p-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Certificate of Good Moral Requests"}),e.jsx(f,{onClick:()=>y(!0),className:"bg-white text-blue-900 hover:bg-blue-100",children:"Scan QR Code"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(A,{placeholder:"Search by resident name...",value:j,onChange:s=>$(s.target.value),className:"max-w-sm mb-4"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(I,{children:[e.jsx(L,{children:e.jsxs(h,{children:[e.jsx(p,{children:"Name"}),e.jsx(p,{children:"Purpose"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Action"})]})}),e.jsx(O,{children:P.length?P.map(s=>e.jsxs(h,{children:[e.jsxs(l,{children:[s.resident.first_name," ",s.resident.last_name]}),e.jsx(l,{children:s.purpose}),e.jsx(l,{className:"capitalize",children:s.status}),e.jsxs(l,{children:[s.status==="on process"&&e.jsx(f,{size:"sm",onClick:()=>B(s),disabled:r,children:r&&t?.id===s.id?"Printing...":"Print"}),(s.status==="ready for pick-up"||s.status==="released")&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>B(s,!0),disabled:r,children:r&&t?.id===s.id?"Reprinting...":"Reprint"}),s.status==="pending"&&e.jsx("span",{className:"text-gray-500 font-semibold",children:"Pending"})]})]},s.id)):e.jsx(h,{children:e.jsx(l,{colSpan:4,className:"text-center text-gray-500",children:"No requests found."})})})]})})]}),e.jsx(K,{open:D,onClose:()=>y(!1),onScanSuccess:k}),t&&e.jsxs("div",{id:"print-area",className:"hidden print:block relative bg-white text-black font-serif",style:{width:"185mm",height:"270mm",padding:"12mm",border:"10px solid #1E3A8A"},children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("img",{src:"/images/logo.png",alt:"Logo Left",className:"w-20 h-20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:"Republic of the Philippines"}),e.jsx("p",{className:"text-sm",children:"Province of Misamis Oriental"}),e.jsx("p",{className:"text-sm",children:"City of Cagayan de Oro"}),e.jsx("p",{className:"font-bold uppercase text-blue-800",children:"Barangay Iponan"})]}),e.jsx("img",{src:"/images/cdologo.png",alt:"Logo Right",className:"w-20 h-20"})]}),e.jsx("h2",{className:"mt-4 font-bold text-lg uppercase text-blue-700",children:"Office of the Punong Barangay"}),e.jsx("hr",{className:"border-blue-700 my-2"}),e.jsx("h1",{className:"text-3xl font-bold underline uppercase text-blue-900",children:"Certificate of Good Moral Character"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mt-10",children:[e.jsx("div",{className:"col-span-1 pr-4 text-sm",children:e.jsxs("div",{className:"p-4 rounded-lg shadow-md border border-blue-700 bg-blue-50",children:[e.jsx("h2",{className:"font-bold text-blue-800 text-center mb-4 text-base",children:"Barangay Officials"}),d&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold text-[15px]",children:d.complete_name}),e.jsx("p",{children:"Punong Barangay"})]}),w.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"underline",children:"Barangay Kagawad"}),e.jsx("ul",{className:"ml-2 mb-3 list-disc list-inside",children:w.map(s=>e.jsx("li",{className:"text-[15px] font-medium",children:s.complete_name},s.id))})]}),v&&e.jsxs("p",{className:"mt-2 font-bold text-[15px]",children:[v.complete_name," - SK Chairman"]}),S&&e.jsxs("p",{className:"mt-2 font-bold text-[15px]",children:[S.complete_name," - Secretary"]}),C&&e.jsxs("p",{className:"mt-2 font-bold text-[15px]",children:[C.complete_name," - Treasurer"]})]})}),e.jsxs("div",{className:"col-span-2 pl-6 text-justify text-[15px] relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center opacity-10 pr-10",children:e.jsx("img",{src:"/images/logo.png",alt:"Watermark",className:"w-90 h-90"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{className:"mt-2",children:["This is to certify that ",e.jsxs("span",{className:"font-bold underline",children:[t.resident.first_name," ",t.resident.last_name]})," is known to be of good moral character and a law-abiding citizen of Barangay Iponan, Cagayan de Oro City."]}),e.jsxs("p",{className:"mt-4",children:["This certification is issued upon request for the purpose of ",e.jsx("span",{className:"font-bold underline",children:t.purpose}),"."]}),e.jsxs("p",{className:"mt-4",children:["Given this ",e.jsx("span",{className:"underline",children:T})," at Barangay Iponan, Cagayan de Oro City, Misamis Oriental."]}),d&&e.jsxs("div",{className:"mt-16 text-right pr-16",children:[e.jsx("p",{className:"font-bold uppercase text-blue-900",children:d.complete_name}),e.jsx("p",{children:"Punong Barangay"})]}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx(E,{value:M(t.qr_token),size:120})}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Scan QR code to verify release status"})]})]})]})]})]})}export{ue as default};
