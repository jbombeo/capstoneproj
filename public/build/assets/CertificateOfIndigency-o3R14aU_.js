import{u as Q,r as n,j as e,H as z,b as P}from"./app-pOO083-e.js";import{A as F}from"./app-layout-Dc3hkrhW.js";import{T as L,a as A,b as h,c as p,d as H,e as c}from"./table-BS9Jhd1O.js";import{B as f}from"./button-C04eTuKF.js";import{I as K}from"./input-BNUIgu_-.js";import{F as E,z as o}from"./index-CJOt3l_0.js";import{Q as M,a as U}from"./QRScannerModal-BYwcAOmS.js";/* empty css            */import"./app-sidebar-header-COL4hiO2.js";import"./createLucideIcon-DoMVaiJs.js";import"./index-D3C--ds9.js";import"./index-hFgQNbVr.js";import"./index-BvNCmLem.js";import"./index-DwhOcVGB.js";import"./log-out-02q7rZj1.js";import"./x-C-J8wUVu.js";import"./index-D0bkFEMS.js";import"./settings-BYB2_0H7.js";import"./file-text-pZ84JjBm.js";import"./dialog-C6812wCE.js";const W=a=>{if(a>3&&a<21)return`${a}th`;switch(a%10){case 1:return`${a}st`;case 2:return`${a}nd`;case 3:return`${a}rd`;default:return`${a}th`}};function xe(){const{props:a}=Q(),[_,g]=n.useState(a.requests||[]),[i]=n.useState(a.officials||[]),[j,$]=n.useState(""),[t,b]=n.useState(null),[r,y]=n.useState(!1),[T,N]=n.useState(!1),x=new Date,I=`${W(x.getDate())} of ${x.toLocaleDateString("en-US",{month:"long"})}, ${x.getFullYear()}`,d=i.find(s=>s.position==="Punong Barangay"),v=i.filter(s=>s.position==="Barangay Kagawad"),w=i.find(s=>s.position==="SK Chairman"),S=i.find(s=>["Secretary","Barangay Secretary"].includes(s.position)),C=i.find(s=>["Treasurer","Barangay Treasurer"].includes(s.position)),k=async s=>{try{await P.post(`/documentrequests/release/${s}`),g(m=>m.map(l=>l.qr_token===s?{...l,status:"released"}:l)),o.success("Document status updated to Released!")}catch{o.error("Failed to release document. Invalid QR code?")}},R=async(s,m=!1)=>{b(s),setTimeout(async()=>{if(!r){y(!0);try{if(!m&&s.status==="on process"){const l=await P.put(`/documentrequests/${s.id}/ready`);g(O=>O.map(u=>u.id===s.id?{...u,status:"ready for pick-up"}:u)),o.success(l.data.message||"Document marked Ready for Pick-up!")}else m&&o.success("Reprinting document...")}catch{o.error("Failed to update document status.")}finally{y(!1)}window.print(),b(null)}},200)},B=_.filter(s=>`${s.resident.first_name} ${s.resident.last_name}`.toLowerCase().includes(j.toLowerCase())),D=s=>s?`${window.location.origin}/documentrequests/release/${s}`:"";return e.jsxs(F,{breadcrumbs:[{title:"Certificate of Indigency",href:"/certificate-of-indigency"}],children:[e.jsx(z,{title:"Certificate of Indigency"}),e.jsx(E,{position:"top-right"}),e.jsxs("div",{className:"flex justify-between items-center mb-8 bg-green-600 text-white shadow p-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Certificate of Indigency Requests"}),e.jsx(f,{onClick:()=>N(!0),className:"bg-white text-blue-900 hover:bg-blue-100",children:"Scan QR Code"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(K,{placeholder:"Search by resident name...",value:j,onChange:s=>$(s.target.value),className:"max-w-sm mb-4"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(L,{children:[e.jsx(A,{children:e.jsxs(h,{children:[e.jsx(p,{children:"Name"}),e.jsx(p,{children:"Purpose"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Action"})]})}),e.jsx(H,{children:B.length?B.map(s=>e.jsxs(h,{children:[e.jsxs(c,{children:[s.resident.first_name," ",s.resident.last_name]}),e.jsx(c,{children:s.purpose}),e.jsx(c,{className:"capitalize",children:s.status}),e.jsxs(c,{children:[s.status==="on process"&&e.jsx(f,{size:"sm",onClick:()=>R(s),disabled:r,children:r&&t?.id===s.id?"Printing...":"Print"}),(s.status==="ready for pick-up"||s.status==="released")&&e.jsx(f,{size:"sm",variant:"outline",onClick:()=>R(s,!0),disabled:r,children:r&&t?.id===s.id?"Reprinting...":"Reprint"}),s.status==="pending"&&e.jsx("span",{className:"text-gray-500 font-semibold",children:"Pending"})]})]},s.id)):e.jsx(h,{children:e.jsx(c,{colSpan:4,className:"text-center text-gray-500",children:"No requests found."})})})]})})]}),e.jsx(M,{open:T,onClose:()=>N(!1),onScanSuccess:k}),t&&e.jsxs("div",{id:"print-area",className:"hidden print:block relative bg-white text-black font-serif",style:{width:"185mm",height:"270mm",padding:"12mm",border:"10px solid #1E3A8A"},children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("img",{src:"/images/logo.png",alt:"Logo Left",className:"w-20 h-20"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:"Republic of the Philippines"}),e.jsx("p",{className:"text-sm",children:"Province of Misamis Oriental"}),e.jsx("p",{className:"text-sm",children:"City of Cagayan de Oro"}),e.jsx("p",{className:"font-bold uppercase text-blue-800",children:"Barangay Iponan"})]}),e.jsx("img",{src:"/images/cdologo.png",alt:"Logo Right",className:"w-20 h-20"})]}),e.jsx("h2",{className:"mt-4 font-bold text-lg uppercase text-blue-700",children:"Office of the Punong Barangay"}),e.jsx("hr",{className:"border-blue-700 my-2"}),e.jsx("h1",{className:"text-3xl font-bold underline uppercase text-blue-900",children:"Certificate of Indigency"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mt-10",children:[e.jsx("div",{className:"col-span-1 pr-4 text-sm",children:e.jsxs("div",{className:"p-4 rounded-lg shadow-md border border-blue-700 bg-blue-50",children:[e.jsx("h2",{className:"font-bold text-blue-800 text-center mb-4 text-base",children:"Barangay Officials"}),d&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold text-[15px]",children:d.complete_name}),e.jsx("p",{className:"mb-3",children:"Punong Barangay"})]}),v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"underline",children:"Barangay Kagawad"}),e.jsx("ul",{className:"ml-2 mb-3 list-disc list-inside",children:v.map(s=>e.jsx("li",{className:"text-[15px] font-medium",children:s.complete_name},s.id))})]}),w&&e.jsxs("p",{className:"mt-2",children:[e.jsx("span",{className:"font-bold text-[15px]",children:w.complete_name}),e.jsx("br",{}),"SK Chairman"]}),S&&e.jsxs("p",{className:"mt-3",children:[e.jsx("span",{className:"font-bold text-[15px]",children:S.complete_name}),e.jsx("br",{}),"Secretary"]}),C&&e.jsxs("p",{className:"mt-3",children:[e.jsx("span",{className:"font-bold text-[15px]",children:C.complete_name}),e.jsx("br",{}),"Treasurer"]})]})}),e.jsxs("div",{className:"col-span-2 pl-6 text-justify text-[15px] relative",children:[e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center opacity-10 pr-10",children:e.jsx("img",{src:"/images/logo.png",alt:"Watermark",className:"w-90 h-90"})}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{className:"mt-2",children:["This is to certify that ",e.jsxs("span",{className:"font-bold underline",children:[t.resident.first_name," ",t.resident.last_name]})," residing at Barangay Iponan, Cagayan de Oro City, is a bona fide resident of this barangay."]}),e.jsxs("p",{className:"mt-4",children:["This certification is issued upon request for the purpose of ",e.jsx("span",{className:"font-bold underline",children:t.purpose}),"."]}),e.jsxs("p",{className:"mt-4",children:["Given this ",e.jsx("span",{className:"underline",children:I})," at Barangay Iponan, Cagayan de Oro City, Misamis Oriental."]}),d&&e.jsxs("div",{className:"mt-16 text-right pr-16",children:[e.jsx("p",{className:"font-bold uppercase text-blue-900",children:d.complete_name}),e.jsx("p",{children:"Punong Barangay"})]}),e.jsx("div",{className:"flex justify-center mt-8",children:e.jsx(U,{value:D(t.qr_token),size:120})}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Scan QR code to verify release status"})]})]})]})]})]})}export{xe as default};
