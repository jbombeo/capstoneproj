import{u as R,r as l,j as e,H as D,b as _}from"./app-pOO083-e.js";import{A as T}from"./app-layout-Dc3hkrhW.js";import{T as k,a as A,b as x,c as o,d as P,e as n}from"./table-BS9Jhd1O.js";import{B as i}from"./button-C04eTuKF.js";import{I as F}from"./input-BNUIgu_-.js";/* empty css            */import"./app-sidebar-header-COL4hiO2.js";import"./createLucideIcon-DoMVaiJs.js";import"./index-D3C--ds9.js";import"./index-hFgQNbVr.js";import"./index-BvNCmLem.js";import"./index-DwhOcVGB.js";import"./log-out-02q7rZj1.js";import"./x-C-J8wUVu.js";import"./index-D0bkFEMS.js";import"./settings-BYB2_0H7.js";import"./file-text-pZ84JjBm.js";function X(){const{props:c}=R(),[g,j]=l.useState(c.requests||[]),[v]=l.useState(c.residents||[]),[m]=l.useState(c.documentTypes||[]),[f,N]=l.useState(""),[w,u]=l.useState(!1),[s,r]=l.useState({resident_id:"",document_type_id:0,purpose:"",payment_method:"cash",amount:"0",reference_number:""});l.useEffect(()=>{const t=m.find(a=>a.id===s.document_type_id);r(a=>({...a,amount:t?t.amount.toString():"0"}))},[s.document_type_id,m]);const b=t=>`â‚±${Number(t??0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`,S=async t=>{try{const d=(await _.put(`/documentrequests/${t.id}/accept`)).data.status;j(p=>p.map(h=>h.id===t.id?{...h,status:d}:h))}catch(a){console.error("Failed to accept request:",a),alert("Failed to accept request.")}},C=async t=>{if(t.preventDefault(),!s.resident_id)return alert("Please select a resident.");if(!s.document_type_id)return alert("Please select a document type.");if(!s.purpose.trim())return alert("Please enter a purpose.");if(s.payment_method==="gcash"&&!s.reference_number.trim())return alert("Please enter GCash reference number.");const a={resident_id:s.resident_id,document_type_id:s.document_type_id,purpose:s.purpose,payment_method:s.payment_method,amount:s.payment_method==="free"?0:Number(s.amount),reference_number:s.payment_method==="gcash"?s.reference_number:null};try{const d=await _.post("/documentrequests",a);j(p=>[...p,d.data]),r({resident_id:"",document_type_id:0,purpose:"",payment_method:"cash",amount:"0",reference_number:""}),u(!1)}catch(d){console.error("Failed to submit request:",d),alert(d.response?.data?.message||"Failed to submit request.")}},y=g.filter(t=>`${t.resident.first_name} ${t.resident.last_name}`.toLowerCase().includes(f.toLowerCase()));return e.jsxs(T,{breadcrumbs:[{title:"Document Requests",href:"/documentrequests"}],children:[e.jsx(D,{title:"Document Requests"}),e.jsxs("div",{className:"flex justify-between items-center mb-8 bg-green-600 text-white shadow-lg p-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Document Requests"}),e.jsx(i,{onClick:()=>u(!0),children:"+ Request Document"})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(F,{placeholder:"Search by resident name...",value:f,onChange:t=>N(t.target.value),className:"max-w-sm mb-4"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(k,{children:[e.jsx(A,{children:e.jsxs(x,{children:[e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Document Type"}),e.jsx(o,{children:"Purpose"}),e.jsx(o,{children:"Payment Method"}),e.jsx(o,{children:"Amount"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Action"})]})}),e.jsx(P,{children:y.length>0?y.map(t=>e.jsxs(x,{children:[e.jsxs(n,{children:[t.resident.first_name," ",t.resident.last_name]}),e.jsx(n,{children:t.document_type?.name}),e.jsx(n,{children:t.purpose}),e.jsx(n,{children:t.payments?.[0]?.payment_method??"N/A"}),e.jsx(n,{children:b(t.payments?.[0]?.amount??t.document_type?.amount)}),e.jsx(n,{className:"capitalize font-semibold",children:t.status}),e.jsxs(n,{children:[t.status==="pending"&&e.jsx(i,{size:"sm",onClick:()=>S(t),children:"Accept"}),t.status==="on process"&&e.jsx("span",{className:"text-gray-500 font-semibold",children:"Accepted"}),t.status==="ready for pick-up"&&e.jsx("span",{className:"text-blue-600 font-semibold",children:"Ready"}),t.status==="released"&&e.jsx("span",{className:"text-green-600 font-semibold",children:"Released"}),t.status==="declined"&&e.jsx("span",{className:"text-red-600 font-semibold",children:"Declined"})]})]},t.id)):e.jsx(x,{children:e.jsx(n,{colSpan:7,className:"text-center text-gray-500",children:"No Document Requests found."})})})]})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md shadow-lg",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Request Document"}),e.jsxs("form",{onSubmit:C,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Resident"}),e.jsxs("select",{className:"w-full border rounded p-2",value:s.resident_id,onChange:t=>r({...s,resident_id:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"Select Resident"}),v.map(t=>e.jsxs("option",{value:t.id,children:[t.first_name," ",t.last_name]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Document Type"}),e.jsxs("select",{className:"w-full border rounded p-2",value:s.document_type_id,onChange:t=>r({...s,document_type_id:Number(t.target.value)}),required:!0,children:[e.jsx("option",{value:0,children:"Select Document Type"}),m.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Purpose"}),e.jsx("input",{type:"text",className:"w-full border rounded p-2",value:s.purpose,onChange:t=>r({...s,purpose:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Payment Method"}),e.jsxs("select",{className:"w-full border rounded p-2",value:s.payment_method,onChange:t=>r({...s,payment_method:t.target.value}),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"gcash",children:"Gcash"}),e.jsx("option",{value:"free",children:"Free"})]})]}),s.payment_method!=="free"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Amount"}),e.jsx("input",{type:"text",className:"w-full border rounded p-2 bg-gray-100",value:b(s.amount),readOnly:!0})]}),s.payment_method==="gcash"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"GCash Reference Number"}),e.jsx("input",{type:"text",className:"w-full border rounded p-2",value:s.reference_number,onChange:t=>r({...s,reference_number:t.target.value}),required:!0}),e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:"/images/gcash.jpg",alt:"GCash QR",className:"w-32 h-32 mx-auto"})})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(i,{type:"submit",children:"Submit"})]})]})]})})]})}export{X as default};
