import{r as c,j as e,H as B,b as N}from"./app-_wj1wiEc.js";import{F as I,z as H}from"./index-9aUBe4GY.js";import{I as C}from"./input-error-D_zbtnVJ.js";import{B as y}from"./button-HZSfloRH.js";import{I as z}from"./input-CaSbsQoB.js";import{L as w}from"./label-DuuBaXdl.js";import{D as L,a as A,b as M,c as T,d as $}from"./dialog-BHDE3h_S.js";import{L as q}from"./loader-circle-le3MHRk3.js";import"./app-DgE45SX0.js";import"./utils-csTuJWuA.js";import"./clsx-B-dksMZM.js";import"./index-Dl6FYVux.js";import"./index-CObx42Nt.js";import"./index-DVkLe2dy.js";import"./index-DlLLoGOC.js";import"./x-cF_pgnf8.js";import"./createLucideIcon-Dk2zpREm.js";function oe({zones:m,heads:o}){const x={email:"",last_name:"",first_name:"",middle_name:"",birth_date:"",birth_place:"",age:"",zone_id:"",relationto_head_of_family:"",civil_status:"",occupation:"",religion:"",nationality:"Filipino",gender:"",skills:"",remarks:"",family_head_id:"",image:null},[a,n]=c.useState(x),[f,u]=c.useState([]),[g,_]=c.useState(!1),[s,v]=c.useState({}),[D,F]=c.useState(null),[R,j]=c.useState(!1),p=c.useMemo(()=>{if(!a.birth_date)return"";const t=new Date(a.birth_date),i=new Date;let r=i.getFullYear()-t.getFullYear();const h=i.getMonth()-t.getMonth();return(h<0||h===0&&i.getDate()<t.getDate())&&r--,r},[a.birth_date]);c.useEffect(()=>{p&&a.age!==p.toString()&&n(t=>({...t,age:p.toString()}))},[p]),c.useEffect(()=>{if(a.relationto_head_of_family==="Head"){u([]),n(t=>({...t,family_head_id:""}));return}u(o)},[a.relationto_head_of_family,o]),c.useEffect(()=>{if(!a.family_head_id)return;const t=o.find(i=>String(i.id)===String(a.family_head_id));t&&n(i=>({...i,zone_id:String(t.zone_id)}))},[a.family_head_id]);const l=(t,i)=>{if(t==="relationto_head_of_family"){n(r=>({...r,relationto_head_of_family:i,family_head_id:i==="Head"?"":r.family_head_id,zone_id:r.zone_id}));return}n(r=>({...r,[t]:i})),t==="image"&&i&&F(URL.createObjectURL(i))},O=["email","last_name","first_name","birth_date","gender"],k=()=>{const t={};return O.forEach(i=>{a[i]||(t[i]="This field is required")}),a.relationto_head_of_family==="Head"&&!a.zone_id&&(t.zone_id="Zone is required for head of family."),a.relationto_head_of_family!=="Head"&&!a.family_head_id&&(t.family_head_id="Please select your head of family."),v(t),Object.keys(t).length===0},E=t=>{if(t.preventDefault(),!k())return;_(!0),v({});const i=new FormData;Object.entries(a).forEach(([r,h])=>{r==="image"?h&&i.append(r,h):i.append(r,h==null?"":String(h))}),N.post("/resident/register",i,{forceFormData:!0,onSuccess:()=>{n(x),F(null),H.success("Registration submitted! Please wait for admin approval."),N.visit("/login")},onError:r=>{v(r||{}),H.error("Failed to register. Please check the form.")},onFinish:()=>_(!1)})},P=()=>{j(!1),N.visit("/")};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(B,{title:"Resident Registration"}),e.jsx(I,{position:"top-right",toastOptions:{duration:4e3}}),e.jsxs("header",{className:"fixed top-0 left-0 w-full z-50 bg-cover bg-center shadow-lg",style:{backgroundImage:"url('/images/iponan2.jpg')"},children:[e.jsx("div",{className:"absolute inset-0 bg-green-900 bg-opacity-70"}),e.jsxs("div",{className:"relative max-w-5xl mx-auto flex items-center justify-between px-6 py-3 md:py-6",children:[e.jsx("img",{src:"/images/logo.png",alt:"Barangay Logo",className:"h-12 w-12 md:h-20 md:w-20 rounded-full border-2 border-white shadow"}),e.jsxs("div",{className:"text-center text-white px-2",children:[e.jsx("h1",{className:"text-lg md:text-2xl font-bold uppercase",children:"Barangay Resident Registration"}),e.jsx("p",{className:"text-xs md:text-sm opacity-90 italic",children:"Official Government Service Portal"})]}),e.jsx("img",{src:"/images/cdologo.png",alt:"Gov Seal",className:"h-17 w-12 md:h-20 md:w-20 rounded-full border-white shadow"})]})]}),e.jsx("main",{className:"max-w-3xl mx-auto bg-white shadow-lg rounded-2xl border border-gray-200 p-8 pt-40 md:pt-56 space-y-8",children:e.jsxs("form",{onSubmit:E,encType:"multipart/form-data",className:"space-y-8",children:[e.jsx(S,{title:"Personal Information"}),e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[e.jsx(d,{label:"Email Address *",name:"email",type:"email",value:a.email,onChange:l,error:s.email}),e.jsx(d,{label:"First Name *",name:"first_name",value:a.first_name,onChange:l,error:s.first_name}),e.jsx(d,{label:"Middle Name",name:"middle_name",value:a.middle_name,onChange:l,error:s.middle_name}),e.jsx(d,{label:"Last Name *",name:"last_name",value:a.last_name,onChange:l,error:s.last_name}),e.jsx(d,{label:"Birth Date *",name:"birth_date",type:"date",value:a.birth_date,onChange:l,error:s.birth_date}),e.jsx(d,{label:"Birth Place",name:"birth_place",value:a.birth_place,onChange:l,error:s.birth_place}),e.jsx(d,{label:"Religion",name:"religion",value:a.religion,onChange:l,error:s.religion}),e.jsx(d,{label:"Nationality",name:"nationality",value:a.nationality,onChange:l,error:s.nationality}),p&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{className:"font-medium",children:"Age"}),e.jsx("div",{className:"p-2 border rounded bg-gray-100 text-gray-700",children:p})]}),a.relationto_head_of_family==="Head"&&e.jsx(b,{label:"Zone *",name:"zone_id",value:a.zone_id,onChange:l,error:s.zone_id,options:m.map(t=>t.zone),optionValues:m.map(t=>t.id.toString())}),e.jsx(b,{label:"Gender *",name:"gender",value:a.gender,onChange:l,error:s.gender,options:["Male","Female","Other"]}),e.jsx(b,{label:"Civil Status",name:"civil_status",value:a.civil_status,onChange:l,options:["Single","Married","Widow","Other"]})]}),e.jsx(S,{title:"Household Information"}),e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[e.jsx(b,{label:"Relation to Head of Family *",name:"relationto_head_of_family",value:a.relationto_head_of_family,onChange:l,error:s.relationto_head_of_family,options:["Head","Wife","Husband","Son","Daughter","Brother","Sister","Relative","Boarder","Other"],optionValues:["Head","Wife","Husband","Son","Daughter","Brother","Sister","Relative","Boarder","Other"]}),e.jsx(d,{label:"Occupation",name:"occupation",value:a.occupation,onChange:l}),a.relationto_head_of_family&&a.relationto_head_of_family!=="Head"&&e.jsx(b,{label:"Select Head of Family *",name:"family_head_id",value:a.family_head_id,onChange:l,error:s.family_head_id,options:f.map(t=>{const i=m.find(r=>r.id===t.zone_id)?.zone??`Zone ${t.zone_id}`;return`${t.full_name} — ${i}`}),optionValues:f.map(t=>t.id.toString())})]}),e.jsx(S,{title:"Additional Information"}),e.jsxs("div",{className:"grid gap-6 sm:grid-cols-2",children:[e.jsx(d,{label:"Skills",name:"skills",value:a.skills,onChange:l}),e.jsx(d,{label:"Remarks",name:"remarks",value:a.remarks,onChange:l})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:"image",className:"font-medium",children:"Upload Valid Photo"}),e.jsx(z,{id:"image",type:"file",accept:"image/*",onChange:t=>l("image",t.target.files?.[0]||null),className:"border rounded-lg p-2 bg-white"}),e.jsx(C,{message:s.image}),D&&e.jsx("img",{src:D,alt:"Preview",className:"w-28 h-28 mt-3 object-cover rounded-full border shadow"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mt-6",children:[e.jsxs(y,{type:"submit",disabled:g,className:"flex items-center justify-center w-full sm:w-auto py-3 px-8 text-white text-lg font-semibold rounded-lg shadow-md bg-blue-900 hover:bg-blue-800 transition-all",children:[g&&e.jsx(q,{className:"h-5 w-5 mr-2 animate-spin"}),g?"Submitting…":"Register"]}),e.jsx(y,{type:"button",onClick:()=>j(!0),className:"w-full sm:w-auto py-3 px-8 text-lg font-semibold rounded-lg shadow-md bg-red-600 hover:bg-red-700 text-white transition-all",children:"Cancel"})]})]})}),e.jsx(L,{open:R,onOpenChange:j,children:e.jsxs(A,{className:"sm:max-w-md",children:[e.jsxs(M,{children:[e.jsx(T,{className:"text-lg font-semibold text-gray-800",children:"Cancel Registration"}),e.jsx($,{className:"text-sm text-gray-600",children:"Are you sure you want to cancel? All entered data will be lost."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-6 justify-center",children:[e.jsx(y,{type:"button",onClick:()=>j(!1),className:"w-full sm:w-auto px-8 py-2.5 text-sm font-semibold rounded-lg shadow-md border border-gray-300 text-gray-700 bg-white hover:bg-gray-100 transition-all",children:"No, Stay Here"}),e.jsx(y,{type:"button",onClick:P,className:"w-full sm:w-auto px-8 py-2.5 text-sm font-semibold rounded-lg shadow-md bg-red-600 hover:bg-red-700 text-white transition-all",children:"Yes, Cancel"})]})]})})]})}function S({title:m}){return e.jsx("h2",{className:"text-xl font-semibold text-blue-900 border-b pb-2",children:m})}function d({label:m,name:o,type:x="text",value:a,onChange:n,error:f}){return e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{htmlFor:o,className:"font-medium",children:m}),e.jsx(z,{id:o,name:o,type:x,value:a,onChange:u=>n(o,u.target.value),className:"rounded-lg border-gray-300"}),f&&e.jsx(C,{message:f})]})}function b({label:m,name:o,value:x,onChange:a,error:n,options:f,optionValues:u}){return e.jsxs("div",{className:"grid gap-2",children:[e.jsx(w,{className:"font-medium",children:m}),e.jsxs("select",{id:o,value:x,onChange:g=>a(o,g.target.value),className:"border rounded-lg p-2 bg-white",children:[e.jsx("option",{value:"",children:`Select ${m}`}),f.map((g,_)=>e.jsx("option",{value:u?u[_]:g,children:g},_))]}),n&&e.jsx(C,{message:n})]})}export{oe as default};
